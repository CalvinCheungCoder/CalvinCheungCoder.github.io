<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Calvin çš„ä¸ªäººä¸»é¡µï¼Œä¸»è¦è®°å½•æŠ€æœ¯ã€è¯»ä¹¦ã€æŠ•èµ„ç†è´¢ç­‰ç›¸å…³å†…å®¹ï¼Œåº§å³é“­ï¼šStay hungry Stay foolish.">
    <meta name="keyword" content="æŠ€æœ¯ã€è¯»ä¹¦ã€æ€è€ƒã€æˆé•¿ã€ç†è´¢ã€æŠ•èµ„ã€ç®¡ç†">
    <meta name="referrer" content="no-referrer">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
            iOS App å›½é™…åŒ–ä»¥åŠåº”ç”¨å†…çš„è¯­è¨€åˆ‡æ¢ - DHTalk&#39;s Blog | Stay hungry Stay foolish.
                
    </title>

    <link rel="canonical" href="https://zhangdinghao.cn/2017/04/13/Within-the-application-language-switch/">

    <!-- jQuery (Bootstrap çš„æ‰€æœ‰ JavaScript æ’ä»¶éƒ½ä¾èµ– jQueryï¼Œæ‰€ä»¥å¿…é¡»æ”¾åœ¨å‰è¾¹) -->
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <!-- åŠ è½½ Bootstrap çš„æ‰€æœ‰ JavaScript æ’ä»¶ã€‚ä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦åªåŠ è½½å•ä¸ªæ’ä»¶ã€‚ -->

    <!-- Custom Card JavaScript -->
    <script src="/js/card.js"></script>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">DHTalk&#39;s Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                        
                    
                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    
                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    
                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/home-bg.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                          <a class="tag" href="/tags/#ObjC" title="ObjC">ObjC</a>
                        
                    </div>
                    <h1>iOS App å›½é™…åŒ–ä»¥åŠåº”ç”¨å†…çš„è¯­è¨€åˆ‡æ¢</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by Calvin on
                        2017-04-13
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <p>å› ä¸ºä¸ªäººåœ¨å¼€å‘è‹±è¯­ç›¸å…³çš„Appï¼Œæ‰€ä»¥ä¸ºäº†ä»¥åæ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œå‡†å¤‡åŠ å…¥è¯­è¨€åˆ‡æ¢åŠŸèƒ½ï¼Œä»¥åŠAppå›½é™…åŒ–ã€‚å®ç°åº”ç”¨å†…åˆ‡æ¢è¯­è¨€åæ— éœ€é€€å‡ºåº”ç”¨å³å¯ç”Ÿæ•ˆï¼Œæ–°å®‰è£…Appæ—¶æ ¹æ®ç”¨æˆ·çš„æ‰‹æœºè¯­è¨€æ˜¾ç¤ºå¯¹åº”çš„Appåå­—ä»¥åŠAppå†…çš„è¯­è¨€ã€‚ç°åœ¨å°±è¿™ä¸€éœ€æ±‚è¿›è¡Œå®ç°ã€‚<a id="more"></a></p>
<h3 id="å…³äº-NSBundle"><a href="#å…³äº-NSBundle" class="headerlink" title="å…³äº NSBundle"></a>å…³äº NSBundle</h3><p>Bundle æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå…¶ä¸­åŒ…å«äº†åœ¨ç¨‹åºä¼šä½¿ç”¨åˆ°çš„èµ„æºï¼ŒåŒ…å«äº†å¦‚å›¾åƒã€å£°éŸ³ã€ç¨‹åºä¸­éœ€è¦ç”¨åˆ°çš„æ–‡ä»¶ï¼Œç”šè‡³æ˜¯ç¼–è¯‘å¥½çš„ä»£ç ç­‰ç­‰ã€‚è€Œåœ¨å®ç°è½¯ä»¶å†…é…ç½®è¯­è¨€çš„æ—¶å€™å°±æ˜¯é€šè¿‡ Bundle çš„è·¯å¾„å»è·å–é…ç½®æ–‡ä»¶ï¼Œæ ¹æ®è¿™ä¸ªé…ç½®æ–‡ä»¶å–å‡ºå¯¹åº”çš„å­—ä½“æ¸²æŸ“åˆ° View ä¸Šã€‚</p>
<p>å½“ç„¶ï¼Œé…ç½®ç¨‹åºè¯­è¨€åªæ˜¯ Bundle çš„ä¸€ç§ç”¨é€”ã€‚è¿˜å¯ä»¥ç”¨ Bundle å»è·å–å·¥ç¨‹ä¸­ info.plist çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è·å–ç‰ˆæœ¬å·ï¼šBundle Short Version</span></div><div class="line"><span class="built_in">NSString</span> *shortVersion = [[[<span class="built_in">NSBundle</span> mainBundle] infoDictionary] objectForKey:<span class="string">@"CFBundleShortVersionString"</span>];</div><div class="line"><span class="comment">// è·å–ç‰ˆæœ¬å·ï¼šBundle version</span></div><div class="line"><span class="built_in">NSString</span> *version = [[[<span class="built_in">NSBundle</span> mainBundle] infoDictionary] objectForKey:<span class="string">@"CFBundleVersion"</span>];</div><div class="line"><span class="comment">// è·å–åº”ç”¨æ ‡è¯†ï¼šBundle identifier</span></div><div class="line"><span class="built_in">NSString</span> *bundleIdentifier = [[[<span class="built_in">NSBundle</span> mainBundle] infoDictionary] objectForKey:<span class="string">@"CFBundleIdentifier"</span>];</div><div class="line"><span class="comment">// è·å–åº”ç”¨åç§°ï¼šBundle display name</span></div><div class="line"><span class="built_in">NSString</span> *bundleDisplayName = [[[<span class="built_in">NSBundle</span> mainBundle] infoDictionary] objectForKey:<span class="string">@"CFBundleDisplayName"</span>];</div><div class="line"><span class="comment">// è·å–Bundle name</span></div><div class="line"><span class="built_in">NSString</span> *bundleName = [[[<span class="built_in">NSBundle</span> mainBundle] infoDictionary] objectForKey:<span class="string">@"CFBundleDisplayName"</span>];</div><div class="line"><span class="comment">// è·å– app åŒ…è·¯å¾„</span></div><div class="line"><span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] bundlePath];</div><div class="line"><span class="comment">// è·å– app èµ„æºç›®å½•è·¯å¾„</span></div><div class="line"><span class="built_in">NSString</span> *resPath = [[<span class="built_in">NSBundle</span> mainBundle] resourcePath];</div></pre></td></tr></table></figure>
<h3 id="Appåç§°å›½é™…åŒ–"><a href="#Appåç§°å›½é™…åŒ–" class="headerlink" title="Appåç§°å›½é™…åŒ–"></a>Appåç§°å›½é™…åŒ–</h3><h4 id="é…ç½®-Project"><a href="#é…ç½®-Project" class="headerlink" title="é…ç½® Project"></a>é…ç½® Project</h4><p>ç‚¹å‡» <code>PROJECT -&gt; info -&gt; Localizations</code> è¿™é‡Œé»˜è®¤åªæœ‰ <code>English</code> ç‚¹å‡»ä¸‹æ–¹çš„åŠ å·å¯ä»¥æ·»åŠ ä½ æƒ³è¦çš„è¯­è¨€ã€‚å…¶ä¸­ï¼Œ<code>zh-Hans</code> æ˜¯ç®€ä½“ä¸­æ–‡ï¼Œ <code>zh-Hant</code> æ˜¯ç¹ä½“ä¸­æ–‡ã€‚</p>
<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/blogimg/20170413149206183440037.png" alt="20170413149206183440037.png"></p>
<h4 id="æ–°å»º-strings-æ–‡ä»¶"><a href="#æ–°å»º-strings-æ–‡ä»¶" class="headerlink" title="æ–°å»º .strings æ–‡ä»¶"></a>æ–°å»º .strings æ–‡ä»¶</h4><p>åœ¨ä¸ <code>info.plist</code> æ–‡ä»¶åŒçº§ç›®å½•ä¸‹åˆ›å»º <code>.strings</code> æ–‡ä»¶ï¼Œ<code>Command + N</code> æ–°å»º <code>Strings File</code> æ–‡ä»¶ï¼Œå‘½ä»¤ä¸º <code>InfoPlist.strings</code>ã€‚</p>
<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/blogimg/20170413149206202285102.png" alt="20170413149206202285102.png"></p>
<h4 id="é…ç½®-strings-æ–‡ä»¶"><a href="#é…ç½®-strings-æ–‡ä»¶" class="headerlink" title="é…ç½® .strings æ–‡ä»¶"></a>é…ç½® .strings æ–‡ä»¶</h4><p>åˆ›å»ºæˆåŠŸåé€‰ä¸­ <code>InfoPlist.strings</code> æ–‡ä»¶ï¼Œç‚¹å‡» <code>Localize...</code> æŒ‰é’®ï¼Œå·¦ä¾§å¼¹æ¡†ä¸­é€‰æ‹©è¯­è¨€ã€‚</p>
<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/blogimg/20170413149206218824740.png" alt="20170413149206218824740.png"></p>
<p>é€‰ä¸­åå†æ¬¡å‹¾é€‰ä¸Šä½ æƒ³è¦çš„å…¶ä»–è¯­è¨€</p>
<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/blogimg/20170413149206223443381.png" alt="20170413149206223443381.png"></p>
<p>å‹¾é€‰æˆåŠŸååœ¨å·¦ä¾§ <code>InfoPlist.strings</code> ä¸­åˆ›å»ºäº†å‡ ä¸ªæ–‡ä»¶ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="/blogimg/20170413149206232317524.png" alt="20170413149206232317524.png"></p>
<p>åˆ†åˆ«åœ¨å„è‡ªçš„æ–‡ä»¶å†…å†™å…¥å¦‚ä¸‹ä»£ç ,å…¶ä¸­ <code>iWords</code> æ˜¯æˆ‘çš„Appåœ¨è‹±è¯­ç¯å¢ƒä¸‹æ˜¾ç¤ºçš„åç§°ï¼Œä½ åªéœ€è¦åœ¨å¯¹åº”çš„æ–‡ä»¶å†…å†™å…¥å¯¹åº”çš„åç§°å³å¯ï¼Œè¿™æ ·å½“æ‰‹æœºè¯­è¨€å˜åŒ–æ—¶ï¼Œå°±ä¼šæ˜¾ç¤ºè¿™äº›å¯¹åº”æ–‡ä»¶å†…çš„ App åç§°ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="built_in">CFBundleDisplayName</span> = <span class="string">"iWords"</span>;</div></pre></td></tr></table></figure>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼ŒApp åç§°çš„å›½é™…åŒ–å®Œæˆã€‚åˆ‡è®°åˆ›å»º <code>.strings</code> æ–‡ä»¶æ—¶ä¸€å®šè¦å‘½åä¸º <code>InfoPlist.strings</code>ã€‚</p>
<h3 id="App-å†…éƒ¨å®ç°è¯­è¨€åˆ‡æ¢"><a href="#App-å†…éƒ¨å®ç°è¯­è¨€åˆ‡æ¢" class="headerlink" title="App å†…éƒ¨å®ç°è¯­è¨€åˆ‡æ¢"></a>App å†…éƒ¨å®ç°è¯­è¨€åˆ‡æ¢</h3><h4 id="æ–°å»ºå¹¶é…ç½®-strings-æ–‡ä»¶"><a href="#æ–°å»ºå¹¶é…ç½®-strings-æ–‡ä»¶" class="headerlink" title="æ–°å»ºå¹¶é…ç½® .strings æ–‡ä»¶"></a>æ–°å»ºå¹¶é…ç½® .strings æ–‡ä»¶</h4><p>å†…éƒ¨å®ç°è¯­è¨€åˆ‡æ¢å’Œ App åç§°å›½é™…åŒ–åŸºæœ¬ä¸€è‡´ï¼Œé¦–å…ˆåˆ›å»º <code>.strings</code> é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘å‘½åä¸ºï¼š<code>DHLocalizable.strings</code>ã€‚</p>
<p>åˆ›å»ºæˆåŠŸåä¾ç„¶ç‚¹å‡»å³ä¾§çš„ <code>Localize...</code> æŒ‰é’®ï¼Œå¹¶æ‰‹åŠ¨å‹¾é€‰å…¶ä»–è¯­è¨€ï¼Œå‹¾é€‰å®Œæˆåå·¦ä¾§ä¾æ—§ç”Ÿæˆå¯¹äºçš„<code>.strings</code>æ–‡ä»¶ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="/blogimg/20170413149206282572841.png" alt="20170413149206282572841.png"></p>
<h4 id="åˆ›å»ºå¤šè¯­è¨€åˆ‡æ¢å·¥å…·ç±»"><a href="#åˆ›å»ºå¤šè¯­è¨€åˆ‡æ¢å·¥å…·ç±»" class="headerlink" title="åˆ›å»ºå¤šè¯­è¨€åˆ‡æ¢å·¥å…·ç±»"></a>åˆ›å»ºå¤šè¯­è¨€åˆ‡æ¢å·¥å…·ç±»</h4><p>åˆ›å»ºç»§æ‰¿äº <code>NSObject</code> çš„å·¥å…·ç±»ï¼Œå‘½åä¸ºï¼š<code>DHLanguageTool</code></p>
<p>å…¶ä¸­ <code>DHLanguageTool.h</code> ä¸­å£°æ˜åŸºæœ¬çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬åˆå§‹åŒ–Appè¯­è¨€ï¼Œå½“å‰çš„è¯­è¨€ï¼Œè®¾ç½®è¯­è¨€ç­‰ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="meta">#define DHLocalizedString(key)  [[DHLanguageTool bundle] localizedStringForKey:(key) value:@<span class="meta-string">""</span> table:@<span class="meta-string">"DHLocalizable"</span>]</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#define DHLanguageKey @<span class="meta-string">"userLanguage"</span></span></div><div class="line"></div><div class="line"><span class="meta">#define DHSimplifiedChinese @<span class="meta-string">"zh-Hans"</span></span></div><div class="line"></div><div class="line"><span class="meta">#define DHTraditionalChinese @<span class="meta-string">"zh-Hant"</span></span></div><div class="line"></div><div class="line"><span class="meta">#define DHEnglish @<span class="meta-string">"en"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DHLanguageTool</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> *  è·å–å½“å‰èµ„æºæ–‡ä»¶</div><div class="line"> */</div><div class="line">+ (<span class="built_in">NSBundle</span> *)bundle;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> *  åˆå§‹åŒ–è¯­è¨€æ–‡ä»¶</div><div class="line"> */</div><div class="line">+ (<span class="keyword">void</span>)initUserLanguage;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> *  è·å–åº”ç”¨å½“å‰è¯­è¨€</div><div class="line"> */</div><div class="line">+ (<span class="built_in">NSString</span> *)userLanguage;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> *  è®¾ç½®å½“å‰è¯­è¨€</div><div class="line"> */</div><div class="line">+ (<span class="keyword">void</span>)setUserlanguage:(<span class="built_in">NSString</span> *)language;</div></pre></td></tr></table></figure>
<p><code>DHLanguageTool.m</code> æ–‡ä»¶ä¸­å¯¹å…¶è¿›è¡Œå®ç°ï¼Œæˆ‘è¿™é‡Œä¸€å…±å¯ä»¥è®¾ç½®3ç§è¯­è¨€ï¼Œå…¶ä¸­åŒ…æ‹¬ç®€ä½“ä¸­æ–‡ï¼Œç¹ä½“ä¸­æ–‡ä»¥åŠè‹±æ–‡ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"DHLanguageTool.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"MainTabBar.h"</span></span></div><div class="line"></div><div class="line"><span class="keyword">static</span> DHLanguageTool *currentLanguage;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DHLanguageTool</span></span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="built_in">NSBundle</span> *bundle = <span class="literal">nil</span>;</div><div class="line"></div><div class="line"><span class="comment">// è·å–å½“å‰èµ„æºæ–‡ä»¶</span></div><div class="line">+ (<span class="built_in">NSBundle</span> *)bundle&#123;</div><div class="line">    <span class="keyword">return</span> bundle;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// åˆå§‹åŒ–è¯­è¨€æ–‡ä»¶</span></div><div class="line">+ (<span class="keyword">void</span>)initUserLanguage&#123;</div><div class="line">    </div><div class="line">    <span class="built_in">NSString</span> *languageString = [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] valueForKey:DHLanguageKey];</div><div class="line">    <span class="keyword">if</span>(languageString.length == <span class="number">0</span>)&#123;</div><div class="line">        <span class="comment">// è·å–ç³»ç»Ÿå½“å‰è¯­è¨€ç‰ˆæœ¬</span></div><div class="line">        <span class="built_in">NSArray</span> *languagesArray = [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] objectForKey:<span class="string">@"AppleLanguages"</span>];</div><div class="line">        languageString = languagesArray.firstObject;</div><div class="line">        [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] setValue:languageString forKey:<span class="string">@"userLanguage"</span>];</div><div class="line">        [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] synchronize];</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// é¿å…ç¼“å­˜ä¼šå‡ºç° zh-Hans-CN åŠå…¶ä»–è¯­è¨€çš„çš„æƒ…å†µ</span></div><div class="line">    <span class="keyword">if</span> ([[DHLanguageTool SimplifiedChinese] containsObject:languageString]) &#123;</div><div class="line">        languageString = [[DHLanguageTool SimplifiedChinese] firstObject]; <span class="comment">// ä¸­æ–‡</span></div><div class="line">        </div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([[DHLanguageTool english] containsObject:languageString]) &#123;</div><div class="line">        languageString = [[DHLanguageTool english] firstObject]; <span class="comment">// è‹±æ–‡</span></div><div class="line">        </div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> ([[DHLanguageTool TraditionalChinese] containsObject:languageString]) &#123;</div><div class="line">        languageString = [[DHLanguageTool TraditionalChinese] firstObject]; <span class="comment">// ç¹ä½“ä¸­æ–‡</span></div><div class="line">        </div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        languageString = [[DHLanguageTool SimplifiedChinese] firstObject]; <span class="comment">// å…¶ä»–é»˜è®¤ä¸ºä¸­æ–‡</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// è·å–æ–‡ä»¶è·¯å¾„</span></div><div class="line">    <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:languageString ofType:<span class="string">@"lproj"</span>];</div><div class="line">    <span class="comment">// ç”Ÿæˆbundle</span></div><div class="line">    bundle = [<span class="built_in">NSBundle</span> bundleWithPath:path];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è‹±æ–‡ç±»å‹æ•°ç»„</span></div><div class="line">+ (<span class="built_in">NSArray</span> *)english &#123;</div><div class="line">    <span class="keyword">return</span> @[<span class="string">@"en"</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ç®€ä½“ä¸­æ–‡ç±»å‹æ•°ç»„</span></div><div class="line">+ (<span class="built_in">NSArray</span> *)SimplifiedChinese&#123;</div><div class="line">    <span class="keyword">return</span> @[<span class="string">@"zh-Hans"</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ç¹ä½“ä¸­æ–‡ç±»å‹æ•°ç»„</span></div><div class="line">+ (<span class="built_in">NSArray</span> *)TraditionalChinese&#123;</div><div class="line">    <span class="keyword">return</span> @[<span class="string">@"zh-Hant"</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// è·å–åº”ç”¨å½“å‰è¯­è¨€</span></div><div class="line">+ (<span class="built_in">NSString</span> *)userLanguage &#123;</div><div class="line">    <span class="built_in">NSString</span> *languageString = [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] valueForKey:DHLanguageKey];</div><div class="line">    <span class="keyword">return</span> languageString;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è®¾ç½®å½“å‰è¯­è¨€</span></div><div class="line">+ (<span class="keyword">void</span>)setUserlanguage:(<span class="built_in">NSString</span> *)language &#123;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>([[<span class="keyword">self</span> userLanguage] isEqualToString:language]) <span class="keyword">return</span>;</div><div class="line">    <span class="comment">// æ”¹å˜bundleçš„å€¼</span></div><div class="line">    <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:language ofType:<span class="string">@"lproj"</span>];</div><div class="line">    bundle = [<span class="built_in">NSBundle</span> bundleWithPath:path];</div><div class="line">    <span class="comment">// æŒä¹…åŒ–</span></div><div class="line">    [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] setValue:language forKey:DHLanguageKey];</div><div class="line">    [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] synchronize];</div><div class="line">    </div><div class="line">    [<span class="built_in">UIApplication</span> sharedApplication].keyWindow.rootViewController = <span class="literal">nil</span>;</div><div class="line">    <span class="keyword">if</span> ([<span class="built_in">UIApplication</span> sharedApplication].keyWindow.rootViewController == <span class="literal">nil</span>) &#123;</div><div class="line">        MainTabBar *tabBar = [[MainTabBar alloc] init];</div><div class="line">        tabBar.selectedIndex = <span class="number">2</span>;</div><div class="line">        [<span class="built_in">UIApplication</span> sharedApplication].keyWindow.rootViewController = tabBar;</div><div class="line">        </div><div class="line">        setToast(<span class="string">@"è¯­è¨€åˆ‡æ¢æˆåŠŸ"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å·¥å…·ç±»å®šä¹‰å®Œæˆååœ¨é¢„ç¼–è¯‘æ–‡ä»¶å†…å¯¼å…¥è¯¥å·¥å…·ç±»çš„å¤´æ–‡ä»¶ã€‚</p>
<h4 id="é…ç½®å¤šè¯­è¨€åˆ‡æ¢-strings-æ–‡ä»¶"><a href="#é…ç½®å¤šè¯­è¨€åˆ‡æ¢-strings-æ–‡ä»¶" class="headerlink" title="é…ç½®å¤šè¯­è¨€åˆ‡æ¢ .strings æ–‡ä»¶"></a>é…ç½®å¤šè¯­è¨€åˆ‡æ¢ .strings æ–‡ä»¶</h4><p>åœ¨åˆšæ‰åˆ›å»ºçš„ <code>DHLocalizable.strings</code> ä¸‹å±•å¼€å¹¶åœ¨å¯¹åº”çš„è¯­è¨€æ–‡ä»¶å†…å¡«å†™éœ€è¦è¿›è¡Œè¯­è¨€åˆ‡æ¢çš„å­—æ®µã€‚å¦‚ï¼šæˆ‘çš„è‹±æ–‡æ–‡ä»¶å’Œä¸­æ–‡æ–‡ä»¶å†…å¡«å†™å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="string">"æŸ¥å•è¯"</span> = <span class="string">"Search"</span>;</div><div class="line"><span class="string">"è®°å•è¯"</span> = <span class="string">"Write"</span>;</div><div class="line"><span class="string">"æˆ‘"</span> = <span class="string">"Me"</span>;</div><div class="line"><span class="string">"é‚€è¯·å¥½å‹"</span> = <span class="string">"Invite friends"</span>;</div><div class="line"><span class="string">"ç»™æˆ‘å¥½è¯„"</span> = <span class="string">"To evaluate"</span>;</div><div class="line"><span class="string">"ä½¿ç”¨å¸®åŠ©"</span> = <span class="string">"Help center"</span>;</div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="string">"æŸ¥å•è¯"</span> = <span class="string">"æŸ¥å•è¯"</span>;</div><div class="line"><span class="string">"è®°å•è¯"</span> = <span class="string">"è®°å•è¯"</span>;</div><div class="line"><span class="string">"æˆ‘"</span> = <span class="string">"æˆ‘"</span>;</div><div class="line"><span class="string">"é‚€è¯·å¥½å‹"</span> = <span class="string">"é‚€è¯·å¥½å‹"</span>;</div><div class="line"><span class="string">"ç»™æˆ‘å¥½è¯„"</span> = <span class="string">"ç»™æˆ‘å¥½è¯„"</span>;</div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šå…¶ä¸­å‰è¾¹å¯¹åº” é”®(key) ï¼Œåè¾¹å¯¹å„ä¸ªè¯­è¨€çš„å€¼(value).</p>
<h4 id="å¼€å§‹ä½¿ç”¨å¹¶åˆå§‹åŒ–"><a href="#å¼€å§‹ä½¿ç”¨å¹¶åˆå§‹åŒ–" class="headerlink" title="å¼€å§‹ä½¿ç”¨å¹¶åˆå§‹åŒ–"></a>å¼€å§‹ä½¿ç”¨å¹¶åˆå§‹åŒ–</h4><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">self</span>.title = DHLocalizedString(<span class="string">@"è¯­è¨€åˆ‡æ¢"</span>);</div></pre></td></tr></table></figure>
<p>å› ä¸ºæˆ‘ä»¬çš„å·¥å…·ç±»ä¸­å·²ç»å®šä¹‰äº†å®ï¼Œæ‰€ä»¥åœ¨éœ€è¦è¿›è¡Œè¯­è¨€åˆ‡æ¢çš„æ§ä»¶è¿›è¡Œè¿™æ ·çš„ä¹¦å†™ï¼Œä¹¦å†™çš„å†…å®¹ä¸ºå„ä¸ªè¯­è¨€æ–‡ä»¶ä¸­çš„ keyã€‚</p>
<p>è®¾ç½®å®Œæˆæ‰€æœ‰å­—æ®µåï¼Œåœ¨ <code>AppDelegate</code> çš„ <code>- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</code> æ–¹æ³•é‡Œå…ˆåˆå§‹åŒ–è¯­è¨€ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">// åˆå§‹åŒ–è¯­è¨€</span></div><div class="line">[DHLanguageTool initUserLanguage];</div></pre></td></tr></table></figure>
<p>å½“ç”¨æˆ·æ‰‹æœºè®¾ç½®äº†ç®€ä½“ä¸­æ–‡ã€ç¹ä½“ä¸­æ–‡æˆ–è€…è‹±æ–‡åï¼Œç‚¹å‡»Appè¿›å…¥åä¼šæ˜¾ç¤ºå¯¹åº”çš„è¯­è¨€ï¼Œä½†å¦‚æœç”¨æˆ·è®¾ç½®äº†å…¶ä»–è¯­è¨€çš„è¯ï¼Œå°±é»˜è®¤æ˜¾ç¤ºä¸­æ–‡äº†ã€‚è¿™é‡Œå¹¶ä¸æ˜¯å”¯ä¸€çš„ï¼Œå…·ä½“è¦é€‚é…å“ªç§è¯­è¨€ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè®¾å®šã€‚</p>
<h4 id="æ›´æ”¹å…¶ä»–è¯­è¨€"><a href="#æ›´æ”¹å…¶ä»–è¯­è¨€" class="headerlink" title="æ›´æ”¹å…¶ä»–è¯­è¨€"></a>æ›´æ”¹å…¶ä»–è¯­è¨€</h4><p>åœ¨åˆ‡æ¢è¯­è¨€çš„ç‚¹å‡»äº‹ä»¶å†…è°ƒç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è®¾ç½®ç®€ä½“ä¸­æ–‡</span></div><div class="line">[DHLanguageTool setUserlanguage:DHSimplifiedChinese];</div><div class="line"><span class="comment">// è®¾ç½®ç¹ä½“ä¸­æ–‡</span></div><div class="line">[DHLanguageTool setUserlanguage:DHTraditionalChinese];</div><div class="line"><span class="comment">// è®¾ç½®è‹±æ–‡</span></div><div class="line">[DHLanguageTool setUserlanguage:DHEnglish];</div></pre></td></tr></table></figure>
<h3 id="å¤šè¯­è¨€åˆ‡æ¢çš„å‘"><a href="#å¤šè¯­è¨€åˆ‡æ¢çš„å‘" class="headerlink" title="å¤šè¯­è¨€åˆ‡æ¢çš„å‘"></a>å¤šè¯­è¨€åˆ‡æ¢çš„å‘</h3><h4 id="æ›´æ”¹è¯­è¨€åé¡µé¢çš„åŠ è½½é€»è¾‘"><a href="#æ›´æ”¹è¯­è¨€åé¡µé¢çš„åŠ è½½é€»è¾‘" class="headerlink" title="æ›´æ”¹è¯­è¨€åé¡µé¢çš„åŠ è½½é€»è¾‘"></a>æ›´æ”¹è¯­è¨€åé¡µé¢çš„åŠ è½½é€»è¾‘</h4><p>1ã€é‡æ–°è½½å…¥rootViewController</p>
<p>è¿™ä¸ªæ–¹æ³•åº”è¯¥æ˜¯ç¼–ç æˆæœ¬æœ€ä½çš„æ–¹æ³•äº†ï¼Œåªéœ€è¦æŠŠåŸæœ‰çš„rootViewControllerç§»é™¤å¹¶æ¸…ç©ºï¼Œç„¶åé‡æ–°è®¾ç½®ä¸€érootViewControllerå°±è¡Œäº†ã€‚ä½†æ˜¯è¿™ç§å®ç°æ–¹å¼ä¼šé‡æ–°åŠ è½½å·²ç»åŸæ¥å·²ç»åŠ è½½å¥½çš„æ‰€æœ‰ç•Œé¢ã€‚</p>
<p>2ã€è¯­è¨€æ”¹å˜å‘é€é€šçŸ¥</p>
<p>åœ¨ç”¨æˆ·åˆ‡æ¢è¯­è¨€çš„æ—¶å€™ï¼Œå‘é€ä¸€ä¸ªé€šçŸ¥ï¼Œç„¶ååœ¨å„ä¸ªç•Œé¢æ¥æ”¶é€šçŸ¥ï¼Œæ›´æ–°æ‰€æœ‰éœ€è¦æ›´æ–°çš„æ–‡æœ¬å³å¯ã€‚è¿™ç§æ–¹æ³•é€‚åˆæ–°å»ºçš„é¡¹ç›®ï¼Œåœ¨ä»£ç ç¼–å†™ä¹‹åˆå°±é¢„ç•™å¥½æ›´æ–°æ–‡æœ¬çš„æ–¹æ³•ï¼Œæ”¶åˆ°é€šçŸ¥åè°ƒç”¨æ­¤æ–¹æ³•å°±è¡Œã€‚å¦‚æœå·²ç»æ˜¯ä¸€ä¸ªå·²ä¸Šçº¿é¡¹ç›®ï¼Œåˆ™æ”¹åŠ¨æˆæœ¬æ¯”è¾ƒé«˜ï¼Œéœ€è¦æ”¹åŠ¨çš„åœ°æ–¹æ¯”è¾ƒå¤šã€‚</p>
<p>3ã€.hæš´éœ²ä¸€ä¸ªæ›´æ–°æ–‡å­—çš„æ–¹æ³•</p>
<p>åœ¨ç”¨æˆ·åˆ‡æ¢è¯­è¨€çš„æ—¶å€™ï¼Œéå†æ‰€æœ‰å·²ç»åŠ è½½çš„ç•Œé¢ï¼Œè°ƒç”¨æ›´æ–°æ–‡å­—çš„æ–¹æ³•ã€‚è¿™ç§å®ç°ä¹Ÿæ˜¯æ¯”è¾ƒé€‚åˆæ–°å»ºçš„é¡¹ç›®ï¼Œåœ¨ä»£ç ç¼–å†™ä¹‹åˆå°±é¢„ç•™å¥½æ›´æ–°æ–‡æœ¬çš„æ–¹æ³•ã€‚å¦‚æœé¡¹ç›®å·²ä¸Šçº¿ï¼Œåˆ™æ”¹åŠ¨æˆæœ¬è¾ƒé«˜ã€‚</p>
<p>æ³¨ï¼šä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä½¿ç”¨çš„æ–¹æ³•1ã€‚</p>
<h4 id="å…³äºæœ¬åœ°åŒ–è¯­è¨€çš„å®å®šä¹‰-DHLocalizedString-lt-key-gt"><a href="#å…³äºæœ¬åœ°åŒ–è¯­è¨€çš„å®å®šä¹‰-DHLocalizedString-lt-key-gt" class="headerlink" title="å…³äºæœ¬åœ°åŒ–è¯­è¨€çš„å®å®šä¹‰ DHLocalizedString(&lt;#key#&gt;)"></a>å…³äºæœ¬åœ°åŒ–è¯­è¨€çš„å®å®šä¹‰ DHLocalizedString(&lt;#key#&gt;)</h4><p>ç³»ç»Ÿè‡ªå¸¦çš„æ–¹æ³•æ˜¯ï¼š<code>NSLocalizedString(&lt;#key#&gt;, &lt;#comment#&gt;)</code>ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä»½å®å®šä¹‰ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="meta">#define NSLocalizedString(key, comment) \</span></div><div class="line">	    [<span class="built_in">NSBundle</span>.mainBundle localizedStringForKey:(key) value:<span class="string">@""</span> table:<span class="literal">nil</span>]</div></pre></td></tr></table></figure>
<p>èƒ½çœ‹åˆ°å®ƒè°ƒç”¨çš„æ˜¯ <code>NSBundle.mainBundle</code> ï¼Œè€Œæˆ‘ä»¬åœ¨æ›´æ”¹è¯­è¨€çš„å·¥å…·ç±»é‡Œçš„ <code>bundle</code> å·²ç»æ›´æ”¹äº†ã€‚<br>æ‰€ä»¥ç³»ç»Ÿçš„ <code>NSLocalizedString(&lt;#key#&gt;, &lt;#comment#&gt;)</code> å·²ç»å¤±æ•ˆï¼Œå¿…é¡»é‡å†™ä¸€ä»½å®å®šä¹‰ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="meta">#define DHLocalizedString(key)  [[DHLanguageTool bundle] localizedStringForKey:(key) value:@<span class="meta-string">""</span> table:@<span class="meta-string">"DHLocalizable"</span>]</span></div></pre></td></tr></table></figure>
<p>1ã€å¿…é¡»ä½¿ç”¨è‡ªå·±çš„ç±»åæ¥è°ƒç”¨ç±»æ–¹æ³• <code>[DHLocalizableController bundle]</code> ä»¥è·å–è‡ªå·±çš„ <code>bundle</code>ã€‚</p>
<p>2ã€table åçš„å‚æ•°ä¸º .strings æ–‡ä»¶çš„æ–‡ä»¶åï¼Œè‹¥ä½ åˆ›å»ºçš„æ–‡ä»¶åä¸º <code>Localizable.strings</code> ï¼Œåˆ™è¯¥å‚æ•°å¯ä¸º nil ï¼Œç³»ç»Ÿé»˜è®¤æŒ‰ <code>Localizable.strings</code> æŸ¥æ‰¾ã€‚å¦åˆ™å¿…é¡»é…ç½®æ–‡ä»¶åï¼Œä¸”åªæ˜¯æ–‡ä»¶åï¼Œä¸åŠ  .stringd åç¼€ã€‚</p>
<h4 id="å…³äºåˆå§‹åŒ–è¯­è¨€-DHLocalizableController-initUserLanguage"><a href="#å…³äºåˆå§‹åŒ–è¯­è¨€-DHLocalizableController-initUserLanguage" class="headerlink" title="å…³äºåˆå§‹åŒ–è¯­è¨€ [DHLocalizableController initUserLanguage]"></a>å…³äºåˆå§‹åŒ–è¯­è¨€ [DHLocalizableController initUserLanguage]</h4><p>åœ¨ <code>initUserLanguage</code> æ–¹æ³•ä¸­æœ‰è¿™æ ·ä¸€æ®µä»£ç æ¥åšåˆ¤æ–­</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">if</span> ([[DHLanguageTool SimplifiedChinese] containsObject:languageString]) &#123;</div><div class="line">        languageString = [[DHLanguageTool SimplifiedChinese] firstObject]; <span class="comment">// ä¸­æ–‡</span></div><div class="line">        </div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([[DHLanguageTool english] containsObject:languageString]) &#123;</div><div class="line">        languageString = [[DHLanguageTool english] firstObject]; <span class="comment">// è‹±æ–‡</span></div><div class="line">        </div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> ([[DHLanguageTool TraditionalChinese] containsObject:languageString]) &#123;</div><div class="line">        languageString = [[DHLanguageTool TraditionalChinese] firstObject]; <span class="comment">// ç¹ä½“ä¸­æ–‡</span></div><div class="line">        </div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        languageString = [[DHLanguageTool SimplifiedChinese] firstObject]; <span class="comment">// å…¶ä»–é»˜è®¤ä¸ºä¸­æ–‡</span></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>å„ä½å¯èƒ½ä¼šå¯¹è¿™ä¸ªåˆ¤æ–­æ¯”è¾ƒç–‘æƒ‘ï¼Œåœ¨è¿™ä¹‹å‰å·²ç»æœ‰åˆ¤æ–­äº†ï¼šå…ˆè·å–ç”¨æˆ·è®¾ç½®çš„è¯­è¨€ï¼Œæœ‰åˆ™ä½¿ç”¨ç”¨æˆ·è®¾ç½®çš„è¯­è¨€ï¼Œæ²¡æœ‰åˆ™ä½¿ç”¨ç³»ç»Ÿè¯­è¨€ã€‚</p>
<p>ç„¶è€Œå› ä¸ºæŸäº›åŸå› ç”¨æˆ·è®¾ç½®è¿‡çš„è¯­è¨€ï¼ˆå¦‚ï¼šzh-Hansï¼‰ä¼šåœ¨å¦ä¸€ä¸ªç›¸åŒå·¥ç¨‹è¿è¡Œä¹‹åå°†è¯¥è¯­è¨€æ›´æ”¹ä¸ºzh-Hans-CZï¼›æˆ–è€…ç”¨æˆ·å°†ç³»ç»Ÿè¯­è¨€è®¾ç½®ä¸ºæ—¥æœ¬è¯­æˆ–å…¶ä»–è¯­è¨€ã€‚</p>
<p>å‡ºç°ä»¥ä¸Šæƒ…å†µæ—¶ DHLocalizedString(&lt;#key#&gt;) è¿™ä¸ªæ–¹æ³•ä» .strings é…ç½®æ–‡ä»¶é‡Œæ˜¯å»ä¸åˆ°å¯¹åº”çš„å­—ä½“ï¼Œå°±ä¼šè¿”å›ç©ºã€‚</p>
<p>åæœè½»åˆ™é¡µé¢ä¸€ç‰‡ç©ºç™½äº†ï¼Œé‡åˆ™ç›´æ¥ crash ï¼Œå¦‚ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *arr = @[DHLocalizedString(<span class="string">@"è¯­è¨€åˆ‡æ¢"</span>),DHLocalizedString(<span class="string">@"æ„è§åé¦ˆ"</span>),DHLocalizedString(<span class="string">@"åŠ å…¥ç¾¤ç»„"</span>)];</div></pre></td></tr></table></figure>
<h4 id="å¦‚æœåšæŒä½¿ç”¨-NSLocalizedString-lt-key-gt-lt-comment-gt-æ–¹æ³•"><a href="#å¦‚æœåšæŒä½¿ç”¨-NSLocalizedString-lt-key-gt-lt-comment-gt-æ–¹æ³•" class="headerlink" title="å¦‚æœåšæŒä½¿ç”¨ NSLocalizedString(&lt;#key#&gt;, &lt;#comment#&gt;) æ–¹æ³•"></a>å¦‚æœåšæŒä½¿ç”¨ NSLocalizedString(&lt;#key#&gt;, &lt;#comment#&gt;) æ–¹æ³•</h4><p>1ã€æœ‰ä¸€ç§æç«¯æƒ…å†µï¼Œæ¯”å¦‚ï¼šè½¯ä»¶éœ€è¦é…ç½®å¤šå›½è¯­è¨€ï¼Œå¾ˆå¤šå¾ˆå¤šçš„é‚£ä¸€ç§ã€‚åœ¨ .strings æ–‡ä»¶é‡Œé…ç½®äº†è®¸å¤šå›½å®¶çš„è¯­è¨€ã€‚ç„¶è€Œåœ¨è½¯ä»¶å†…éƒ¨åªæä¾›ä¸­æ–‡ã€è‹±æ–‡ç­‰æŸå‡ ç§è¯­è¨€ï¼Œå…¶ä»–è¯­è¨€æ ¹æ®ç³»ç»Ÿè¯­è¨€è‡ªé€‚åº”ã€‚ä¸æƒ³åœ¨ <code>initUserLanguage</code> æ–¹æ³•é‡Œåšä¸€å¤§å †çš„ä¹±ä¸ƒå…«ç³Ÿçš„åˆ¤æ–­ã€‚åªè¦åœ¨ <code>initUserLanguage</code> çš„åˆ¤æ–­æ–¹æ³• <code>else</code> é‡Œä½¿ç”¨ç³»ç»Ÿè¯­è¨€ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">	languageString = [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] objectForKey:<span class="string">@"AppleLanguages"</span>][<span class="number">0</span>]; <span class="comment">// å…¶ä»–é»˜è®¤ä¸ºç³»ç»Ÿè¯­è¨€</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2ã€æ¯”å¦‚ï¼šå°±æƒ³ä½¿ç”¨ <code>NSLocalizedString(&lt;#key#&gt;, &lt;#comment#&gt;)</code> æ–¹æ³•ã€‚</p>
<p>æ€»å½’è¿˜æ˜¯æœ‰æ–¹æ³•ä½¿ç”¨ <code>NSLocalizedString(&lt;#key#&gt;, &lt;#comment#&gt;)</code> çš„ã€‚</p>
<p>ä½¿ç”¨ <code>Category</code> ä¸º <code>NSBundle</code> ç±»æ‰©å±•ä¸€ä¸ªè®¾ç½®è¯­è¨€çš„æ–¹æ³•ï¼Œå¹¶ä¸”ä½¿ç”¨ <code>runtime</code> ä¸º <code>NSBundle</code> åŠ¨æ€æ·»åŠ ä¸€ä¸ªå…³äº <code>bundle</code> çš„å±æ€§ï¼Œé‡è½½ <code>NSBundle.mainBundle</code> çš„ <code>localizedStringForKey</code> æ–¹æ³•ã€‚ç›®çš„å°±æ˜¯å°†æ›´æ”¹çš„å­—ä½“ä¼ ç»™ <code>NSLocalizedString(&lt;#key#&gt;, &lt;#comment#&gt;)</code> æ˜ å°„çš„ <code>localizedStringForKey</code> æ–¹æ³•è¿”å›çš„ <code>bundle</code> ï¼Œä½¿å¾—æ›´æ”¹çš„å­—ä½“åº”ç”¨åˆ°ç³»ç»Ÿä¸Šã€‚</p>
<p>å¥½å§ï¼Œshow you the code:</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"NSBundle+DHLanguage.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">NSString</span> *DHBundleKey = <span class="string">@"DHLanguageKey"</span>;</div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BundleEx</span> : <span class="title">NSBundle</span></span></div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">BundleEx</span></span></div><div class="line"></div><div class="line">- (<span class="built_in">NSString</span> *)localizedStringForKey:(<span class="built_in">NSString</span> *)key value:(<span class="built_in">NSString</span> *)value table:(<span class="built_in">NSString</span> *)tableName &#123;</div><div class="line">    <span class="built_in">NSBundle</span> *bundle = objc_getAssociatedObject(<span class="keyword">self</span>, &amp;RDBundleKey);</div><div class="line">    <span class="keyword">if</span> (bundle) &#123;</div><div class="line">        <span class="keyword">return</span> [bundle localizedStringForKey:key value:value table:tableName];</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> [<span class="keyword">super</span> localizedStringForKey:key value:value table:tableName];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSBundle</span> (<span class="title">DHLanguage</span>)</span></div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>)setLanguage:(<span class="built_in">NSString</span> *)language &#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">        object_setClass([<span class="built_in">NSBundle</span> mainBundle], [BundleEx <span class="keyword">class</span>]);</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">id</span> value = language ? [<span class="built_in">NSBundle</span> bundleWithPath:[[<span class="built_in">NSBundle</span> mainBundle] pathForResource:language ofType:<span class="string">@"lproj"</span>]] : <span class="literal">nil</span>;</div><div class="line">    objc_setAssociatedObject([<span class="built_in">NSBundle</span> mainBundle], &amp;RDBundleKey, value, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>1ã€<code>objc_getAssociatedObject</code> å’Œ <code>objc_setAssociatedObject</code> æ˜¯ä¸€å¯¹ <code>getter</code>ã€<code>setter</code> æ–¹æ³•ï¼Œç›®çš„æ˜¯ä¸ºäº†ç»™ <code>NSBundle</code> ç±»åŠ¨æ€æ·»åŠ ä¸€ä¸ªå±æ€§ã€‚</p>
<p>2ã€<code>object_setClass</code>åœ¨ <code>BundleEx</code> é‡Œå®ç°ä¸€ä¸ª <code>localizedStringForKey</code> æ–¹æ³•ï¼Œç„¶åå°† <code>BundleEx</code> è¿™ä¸ªç±»è®¾ç½®ç»™ <code>[NSBundle mainBundle]</code> ã€‚ç›®çš„å°±æ˜¯ç›¸å½“äºé‡è½½ <code>[NSBundle mainBundle]</code> çš„ <code>localizedStringForKey</code> æ–¹æ³•ã€‚</p>
<p>å†è¯´æœ¬ç¯‡æ–‡ç« ï¼Œè¯¥ç±»åˆ«æ–°å¢æ–¹æ³•çš„ä½¿ç”¨ï¼š</p>
<p>åœ¨ <code>DHLocalizableController</code> ç±»çš„ <code>+ (void)setUserlanguage:(NSString *)language</code> æ–¹æ³•é‡Œï¼Œæœ¬åœ°åŒ–å­˜å‚¨è¯­è¨€ä¹‹åè°ƒç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">[<span class="built_in">NSBundle</span> setLanguage:language];</div></pre></td></tr></table></figure>
<p>ä¹‹åï¼Œå…³äº <code>DHLocalizableController</code> ç±»é‡Œè¾¹å…³äº <code>bundle</code> çš„æ“ä½œå°±å¯ä»¥èˆå¼ƒäº†ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šä½¿ç”¨è¿™ç§æ–¹æ³•è¦ç¡®ä¿ä½ çš„ <code>.strings</code> çš„æ–‡ä»¶åä¸º <code>Localizable.strings</code><br>å¦åˆ™è¿˜æ˜¯è¦é‡æ–°è®¾ç½®å®å®šä¹‰ã€‚</p>
</blockquote>
<h3 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h3><p><a href="http://gonghonglou.com/2016/10/29/setlanguage" target="_blank" rel="noopener">å‚è€ƒé“¾æ¥1</a></p>
<p><a href="http://xiaolei0808.com/2016/04/24/Localized-iOS/" target="_blank" rel="noopener">å‚è€ƒé“¾æ¥2</a></p>


                <div id="rewardContainer">
                  <div></div>
                  <button id="rewardButton" disable="enable" onclick="var qr=document.getElementById('QR'); 'none'===qr.style.display?qr.style.display='block':qr.style.display='none'">
                    <span>èµèµ</span>
                  </button>
                  <div id="QR" style="display: none;">
                    <div id="wechat" style="display:inline-block">
                      <img id="wechat_qr" src="/img/wx.png" alt="DIYgod å¾®ä¿¡æ‰«ä¸€æ‰«ï¼Œå‘æˆ‘èµèµ" data-action="zoom">
                      <p>å¾®ä¿¡æ‰«ä¸€æ‰«ï¼Œå‘æˆ‘èµèµ</p>
                    </div><div id="alipay" style="display:inline-block">
                      <img id="alipay_qr" src="/img/ali.png" alt="DIYgod æ”¯ä»˜å®æ‰«ä¸€æ‰«ï¼Œå‘æˆ‘èµèµ" data-action="zoom">
                      <p>æ”¯ä»˜å®æ‰«ä¸€æ‰«ï¼Œå‘æˆ‘èµèµ</p>
                    </div>
                  </div>
                </div>

                <hr>


                

                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2017/04/14/use-sys-mail/" data-toggle="tooltip" data-placement="top" title="iOS ä½¿ç”¨ç³»ç»Ÿé‚®ç®±å®ç°ä¸ªäºº App æ„è§åé¦ˆåŠŸèƒ½">&larr; ä¸Šä¸€ç¯‡</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2017/04/12/iOS-navigation-tabbar/" data-toggle="tooltip" data-placement="top" title="iOS NavigationController å’Œ TabBar è¯¦ç»†è§£æä»¥åŠç”¨æ³•è¯´æ˜">ä¸‹ä¸€ç¯‡ &rarr;</a>
                        </li>
                    
                </ul>

                

                

                <br/>
                
                    <!-- valine å…¬å…±JSä»£ç  start (ä¸€ä¸ªç½‘é¡µåªéœ€æ’å…¥ä¸€æ¬¡) -->
                        <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
                        <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
                    <div id="comment"></div>
                    <script>
                        var notify = false == true ? true : false;
                        var verify = false == true ? true : false;
                        var visitor = false == true ? true : false;
                  new Valine({
                      el: '#comment',
                                notify: notify,
                                verify: verify,
                        enable: 'false'
                        app_id: 'WQIfXvHbniLw45ttBBB3f1KF-gzGzoHsz',
                      app_key: 'E6Jj4yJ5JLhlX5K3QO8AKmXF',
                            placeholder: 'å¿«æ¥è¯„è®ºä¸€ä¸‹å§!',
                            avatar: 'monsterid',
                            pageSize: 10,
                            visitor: visitor
                        });
                </script>
                <!-- valine å…¬å…±JSä»£ç  end -->
                

            </div>
    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#ObjC" title="ObjC">ObjC</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="http://mindhacks.cn/" target="_blank">Mind Hacks</a></li>
                    
                        <li><a href="https://onevcat.com/" target="_blank">å–µç¥</a></li>
                    
                        <li><a href="http://mrpeak.cn/" target="_blank">mrpeak</a></li>
                    
                        <li><a href="http://blog.sunnyxx.com/" target="_blank">sunnyxxçš„æŠ€æœ¯åšå®¢</a></li>
                    
                        <li><a href="https://www.atjason.com/" target="_blank">Jason</a></li>
                    
                        <li><a href="http://blog.devtang.com/" target="_blank">å”å·§</a></li>
                    
                        <li><a href="http://blog.ibireme.com/" target="_blank">ä¼½è“ä¹‹å ‚</a></li>
                    
                        <li><a href="http://colachan.com/" target="_blank">å¯ä¹æ©™</a></li>
                    
                        <li><a href="https://www.bmpi.dev/" target="_blank">æ„å»ºæˆ‘çš„è¢«åŠ¨æ”¶å…¥</a></li>
                    
                        <li><a href="https://coolshell.cn/" target="_blank">é…· å£³ â€“ CoolShell</a></li>
                    
                        <li><a href="https://tinyfool.org/" target="_blank">Tinyfool&#39;s blog</a></li>
                    
                        <li><a href="https://oldj.net/" target="_blank">oldj&#39;s blog</a></li>
                    
                        <li><a href="https://lutaonan.com/" target="_blank">Randy&#39;s Blog</a></li>
                    
                        <li><a href="https://dbarobin.com/" target="_blank">Cryptospace</a></li>
                    
                        <li><a href="http://kittenyang.com/" target="_blank">Kitten çš„æ—¶é—´èƒ¶å›Š</a></li>
                    
                        <li><a href="http://ftqq.com/" target="_blank">æ–¹ç³–æ°”çƒğŸˆ</a></li>
                    
                        <li><a href="https://www.gatesnotes.com/" target="_blank">GatesNotes</a></li>
                    
                        <li><a href="https://imtx.me/" target="_blank">I&#39;M TUALATRIX</a></li>
                    
                        <li><a href="https://zhowkev.in/" target="_blank">Kevin Blog</a></li>
                    
                        <li><a href="https://blog.forecho.com/" target="_blank">forecho&#39;s Blog</a></li>
                    
                        <li><a href="https://daimajia.com/" target="_blank">ä»£ç å®¶</a></li>
                    
                </ul>
                
            </div>

        </div>
    </div>
</article>










    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                    <li>
                        <a href="/atom.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                    <li>
                        <a target="_blank" href="https://twitter.com/zhangdinghao">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/zhang-ding-hao">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">çŸ¥</i>
                            </span>
                        </a>
                    </li>
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/CalvinCheungCoder">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    &copy; 2016 -  2021 Calvin, All rights reserved.
					<br>
                    ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯ | é˜…è¯» | ç”Ÿæ´»
                    <br>
                    <span class="post-count"> æœ¬ç«™å…±è®¡ 160.9k å­— </span>
                    <br>
                    <!-- CNZZ ç»Ÿè®¡ -->
                    <script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1279591338'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279591338%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://zhangdinghao.cn/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-104503948-1';
    var _gaDomain = 'null';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?418b76fef727b6da80febf464b8907d3";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<!-- Side Catalog -->





<!-- Image to hack wechat -->
<img src="https://zhangdinghao.cn/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
