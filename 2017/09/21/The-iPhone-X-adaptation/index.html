<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Stay hungry Stay foolish.">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
          iPhone X 简单适配 - DHTalk | DHTalk&#39;s Blog
        
    </title>

    <link rel="canonical" href="http://CalvinCheungCoder.github.io/2017/09/21/The-iPhone-X-adaptation/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">DHTalk&#39;s Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Image to hack wechat -->
<!-- <img src="http://CalvinCheungCoder.github.io/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="{{ site.baseurl }}/{% if page.header-img %}{{ page.header-img }}{% else %}{{ site.header-img }}{% endif %}" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('https://raw.githubusercontent.com/CalvinCheungCoder/Blog/master/blog-img/20170921150599921935480.png')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                          <a class="tag" href="/tags/#ObjC" title="ObjC">ObjC</a>
                        
                    </div>
                    <h1>iPhone X 简单适配</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by Calvin on
                        2017-09-21
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <p>iOS 11 正式版系统发布后，Xcode 9 也正式发布了，今天正好抽时间对项目进行 iPhone X 的适配。</p>
<p>今年 iPhone 变化最大的当属 iPhone X 了，由于屏幕使用全面屏，并且额头保留了『刘海』以及『耳朵』，导致大部分 App 必须对它进行适配。所幸 iPhone X 使用的图片依旧是 @3x，在适配时仅需要设置部分单独的图片并且处理一下顶部和底部的显示就好了。</p>
<p><a href="https://developer.apple.com/ios/human-interface-guidelines/overview/iphone-x/" target="_blank" rel="external">Apple 官方人机交互指南 iPhone X 部分</a> 详细介绍了 iPhone X 的分辨率、安全显示区域等，想更好适配的可以仔细研读一下。</p>
<h3 id="App-直接在-iPhone-X-运行"><a href="#App-直接在-iPhone-X-运行" class="headerlink" title="# App 直接在 iPhone X 运行"></a><font color="red">#</font> App 直接在 iPhone X 运行</h3><p>先看一下在 iPhone X 直接运行 App 的效果</p>
<p><img src="https://raw.githubusercontent.com/CalvinCheungCoder/Blog/master/blog-img/201709211506000654153.png" alt="201709211506000654153.png"></p>
<p>之所以出现 App 顶部和底部大面积变黑的原因是因为没有设置对应机型的启动图片。为了让 App 充满整个屏幕。我们先设置一张启动图。</p>
<h3 id="设置-iPhone-X-启动图"><a href="#设置-iPhone-X-启动图" class="headerlink" title="# 设置 iPhone X 启动图"></a><font color="red">#</font> 设置 iPhone X 启动图</h3><p>iPhone X 的分辨率为 1125 * 2436，所以先准备一张这个尺寸的启动图。</p>
<p>如果项目启动页使用的是 LaunchImage，可以直接修改 Contents.json 文件，添加一条 iPhone X 启动图的设置。（注意json格式）如下所示：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;extent&quot; : &quot;full-screen&quot;,</div><div class="line">    &quot;idiom&quot; : &quot;iphone&quot;,</div><div class="line">    &quot;subtype&quot; : &quot;2436h&quot;,</div><div class="line">    &quot;filename&quot; : &quot;启动页名称.png&quot;,</div><div class="line">    &quot;minimum-system-version&quot; : &quot;11.0&quot;,</div><div class="line">    &quot;orientation&quot; : &quot;portrait&quot;,</div><div class="line">    &quot;scale&quot; : &quot;3x&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果使用的是 LaunchScreen.storyboard，则需要在对应的 storyboard 设置。成功后再次运行 App 则会正常充满屏幕。</p>
<h3 id="页面布局设置"><a href="#页面布局设置" class="headerlink" title="# 页面布局设置"></a><font color="red">#</font> 页面布局设置</h3><blockquote>
<p>Most apps that use standard, system-provided UI elements like navigation bars, tables, and collections automatically adapt to the device’s new form factor. Background materials extend to the edges of the display and UI elements are appropriately inset and positioned.</p>
</blockquote>
<p>使用官方标准控件基本上苹果会自动的进行页面布局处理，你要修改的地方就很少了。但是有些情况就比较特殊。</p>
<p>1、设置 navigationController 高度为64或者设置 statusBar 高度为20，以及 statusBar 隐藏等，需要进行修改调整。</p>
<p>因为苹果 statusBar 高度由20变成了44，navigation bar 则保持44不变，也就是其他机型上的 navigationController 默认写成 64 的，则需要对其进行设置为88。</p>
<p>对于 iPhone 机型的识别可以根据如下的设备型号进行判断。</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="string">@"iPhone10,1"</span> : <span class="string">@"iPhone 8"</span>,</div><div class="line"><span class="string">@"iPhone10,4"</span> : <span class="string">@"iPhone 8"</span>,</div><div class="line"><span class="string">@"iPhone10,2"</span> : <span class="string">@"iPhone 8 Plus"</span>,</div><div class="line"><span class="string">@"iPhone10,5"</span> : <span class="string">@"iPhone 8 Plus"</span>,</div><div class="line"><span class="string">@"iPhone10,3"</span> : <span class="string">@"iPhone X"</span>,</div><div class="line"><span class="string">@"iPhone10,6"</span> : <span class="string">@"iPhone X"</span>,</div></pre></td></tr></table></figure>
<p>2、部分项目对 UITabBar 进行了自定义，也有可能出现问题。</p>
<p>比如『图拉鼎』同学的奇点App，由于自定义了 TabBar，出现了如图的问题</p>
<p><img src="https://raw.githubusercontent.com/CalvinCheungCoder/Blog/master/blog-img/20170921150600169732035.png" alt="20170921150600169732035.png"></p>
<p>这个问题的解决，可以移步 <a href="https://imtx.me/archives/2374.html" target="_blank" rel="external">图拉鼎同学的博客</a> 查看。</p>
<h3 id="使用-MJRefresh-下拉刷新问题"><a href="#使用-MJRefresh-下拉刷新问题" class="headerlink" title="# 使用 MJRefresh 下拉刷新问题"></a><font color="red">#</font> 使用 MJRefresh 下拉刷新问题</h3><p>网上部分在开发者在进行 iOS 11 适配的时候出现的问题，但是后来发现是由于 iOS 11 API 变化导致。</p>
<p>iOS11 弃用了 <code>automaticallyAdjustsScrollViewInsets</code> 属性，新增<code>contentInsetAdjustmentBehavior</code> 来替代。</p>
<p>如果不想系统帮我们自动设置边距则要在 iOS 11 中加上这句代码</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">scrollView.contentInsetAdjustmentBehavior = <span class="built_in">UIScrollViewContentInsetAdjustmentNever</span>;</div></pre></td></tr></table></figure>
<p>Swift 使用如下</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">if</span> #available(iOS <span class="number">11.0</span>, *) &#123; collectionView.contentInsetAdjustmentBehavior = .never &#125; <span class="keyword">else</span> &#123; <span class="comment">// Fallback on earlier versions &#125;</span></div></pre></td></tr></table></figure>
<h3 id="小结"><a href="#小结" class="headerlink" title="# 小结"></a><font color="red">#</font> 小结</h3><p>由于适配项目目前结构比较简单，所以在 iPhone X 上并未出现太多问题。主要处理的位置有2块，一部分是顶部 statusBar 和 NavigationBar 的单独处理，以及底部超出安全区域页面的处理。</p>
<p>因为 iPhone X 的 Safe area，我们需要对一些页面做一下处理，关于 Safe area 的详细可以参考上文的苹果人机开发指南。</p>
<p>因为我主要使用官方控件并做一些简单自定义，最后适配问题很少，也很快完成，发一张部分页面的效果图</p>
<p><img src="https://raw.githubusercontent.com/CalvinCheungCoder/Blog/master/blog-img/2017092115060025749206.png" alt="2017092115060025749206.png"></p>
<p>如果项目页面比较复杂而且自定义控件比较多的话，可能还需要花费一些时间，尤其是安全区域的处理，以及屏幕方向切换等等问题。仔细写的话就比较多了，而且很多细节性的处理不具有代表性，在这里仅做大致的功能适配记录以供参考。</p>


                <hr>

                

                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2017/09/25/readNote-Apple/" data-toggle="tooltip" data-placement="top" title="读书 -《硅谷革命：成就苹果公司的疯狂往事》">&larr; 上一篇</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2017/09/16/记录一下近况/" data-toggle="tooltip" data-placement="top" title="记录一下近况">下一篇 &rarr;</a>
                        </li>
                    
                </ul>

                

                
                <!-- disqus 评论框 start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus 评论框 end -->
                

            </div>
    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#ObjC" title="ObjC">ObjC</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="http://mindhacks.cn/" target="_blank">Mind Hacks</a></li>
                    
                        <li><a href="https://onevcat.com/" target="_blank">喵神</a></li>
                    
                        <li><a href="http://mrpeak.cn/" target="_blank">mrpeak</a></li>
                    
                        <li><a href="http://blog.sunnyxx.com/" target="_blank">sunnyxx的技术博客</a></li>
                    
                        <li><a href="https://www.atjason.com/" target="_blank">Jason</a></li>
                    
                        <li><a href="http://blog.devtang.com/" target="_blank">唐巧</a></li>
                    
                        <li><a href="http://blog.ibireme.com/" target="_blank">伽蓝之堂</a></li>
                    
                        <li><a href="http://colachan.com/" target="_blank">可乐橙</a></li>
                    
                </ul>
                
            </div>

        </div>
    </div>
</article>




<!-- disqus 公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "www-zhangdinghao-cn";
    var disqus_identifier = "http://CalvinCheungCoder.github.io/2017/09/21/The-iPhone-X-adaptation/";
    var disqus_url = "http://CalvinCheungCoder.github.io/2017/09/21/The-iPhone-X-adaptation/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus 公共JS代码 end -->






    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                    <li>
                        <a href="/atom.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                    <li>
                        <a target="_blank" href="https://twitter.com/zhangdinghao">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/zhang-ding-hao">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/zhangdinghaoforever">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/CalvinCheungCoder">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    &copy; 2016 -  2019 Calvin, All rights reserved.
					<br>
					<span class="post-count"> 本站共计 84.4k 字 </span>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://CalvinCheungCoder.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-104503948-1';
    var _gaDomain = '';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = '4b23bf7f2774bbd61b8967fb89ed56be';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>


<!-- Side Catalog -->





<!-- Image to hack wechat -->
<img src="http://CalvinCheungCoder.github.io/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
